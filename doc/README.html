<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Graph DB on GAE datastore</title>
<meta name="Generator" content="Vim reStructured Text 140 - Vim 7.3" />

<style type="text/css">
/*<![CDATA[*/
body { color: #000; background-color: #fff; margin: 0px 10%; min-width: 720px; font-family: Verdana, sans-serif;
       counter-reset: chapter section subsection subsubsection paragraph lchapter lsection lsubsection lsubsubsection lparagraph}
div.footnote { border-left: 1px solid #000; margin-left: 0em; clear: both }
div.ftext { position: relative; margin-left: 50px }
div.fnumber { float: left; width: 40px; padding: 0em; margin-left: 0.5em; margin-top: 0em }
div.fnumber a { margin: 0px; padding: 0px }
div.ctext { position: relative; margin-left: 100px }
div.cnumber { float: left; width: 90px; padding: 0em; margin-left: 0.5em; margin-top: 0em }
div.cnumber a { margin: 0px; padding: 0px }
div.tip { border: 2px solid #0d0; margin: 0.5em 2em 1em 2em; padding: 0em 1em }
div.warning, div.caution, div.danger, div.error { border: 2px solid #f00; margin: 0.5em 2em 1em 2em; padding: 0em 1em }
div.note, div.hint, div.important { border: 2px solid #000; margin: 0.5em 2em 1em 2em; padding: 0em 1em }
div.figure { display: block; padding: 1em; width: 400px; clear: both}
div.topic { margin: 2em }
div.vstsidebar, div.sidebar { border: 2px solid #aaa; color: #000; background-color: #ffffee; float: right; width: 40%; margin-left: 1em; margin-right: -1em; padding: 1em }
span.strike { text-decoration: line-through }
span.big { font-size: large }
span.small { font-size: small }
span.title { font-style: italic }
span.notetitle { font-size: large; font-weight: 900; font-family: Verdana, sans-serif }
p.toc { font-size: large; font-weight: 900 }
p.notesubtitle { font-weight: 900; font-family: Verdana, sans-serif }
p.attribution { font-style: italic; margin-left: 8em; text-indent: -1.4em }
.vstright { float: right; margin: 1em }
.vstleft { float: left; margin: 1em }
.vstcenter { margin: 1em auto }
blockquote.pull { font-size: large }
p.rubric { font-size: large; margin-left: 2em }
dd.normal { margin-bottom: 0.5em }
dt.option { float: left; margin: 0em 0em 5px 2em; padding: 0px; font-family: monospace }
dd.option { padding: 0px; margin: 0em 0em 5px 10em; text-indent: 0.5em }
dd.option > p { margin: 0px }
dd.normal > p { margin: 0px }
table { border-collapse: collapse; margin: 0.5em 0em }
thead, tfoot { text-align: center; font-weight: bold }
td { border: 1px solid #000; padding: 0.25em; _top: 0%; vertical-align: top }
td blockquote p{ margin: 0px; padding: 0px}
td blockquote { margin: 0px; padding: 0px}
table.vstbless td { border: 0px solid #000; padding: 0.25em; _top: 0%; vertical-align: top }
td > p { margin: 0px }
table.field { border: 0px solid #000; margin-left: 2em; padding: 0.25em; _top: 0%; vertical-align: top }
td.fkey { font-weight: 900 }
td.fval { border: 0px solid #000; padding: 0.25em; _top: 0%; vertical-align: top }
td.fkey { font-weight: 900; border: 0px solid #000; padding: 0.25em; _top: 0%; vertical-align: top }
td.fdkey { text-align: center; font-weight: 900 }
td.fdval { text-align: center; font-style: italic }
td.fakey { text-align: center; font-weight: 900 }
td.faval { border: 0px solid #000; padding: 0.25em; _top: 0%; vertical-align: top }
hr { width: 80%; margin: 1.5em auto }
h1 { text-align: center; clear: both }
h2, h3, h4, h5, h6 { text-align: left; margin-top: 1em; clear: both }
h2 { counter-reset: section subsection subsubsection paragraph }
h3 { counter-reset: subsection subsubsection paragraph }
h4 { counter-reset: subsubsection paragraph }
h5 { counter-reset: paragraph }
h1 a { color: #000; background-color: transparent }
h2 a { color: #000; background-color: transparent }
h3 a { color: #000; background-color: transparent }
h4 a { color: #000; background-color: transparent }
h5 a { color: #000; background-color: transparent }
h6 a { color: #000; background-color: transparent }
p.subh1 { text-align: center; font-size: 120%; font-variant: small-caps }
p.subh2, p.subh3, p.subh4, p.subh5, p.subh6 { text-align: left; font-size: 120%; font-variant: small-caps }
h2:before { content: counter(chapter)" "; counter-increment: chapter }
h3:before { content: counter(chapter)"."counter(section)" "; counter-increment: section }
h4:before { content: counter(chapter)"."counter(section)"."counter(subsection)" "; counter-increment: subsection }
h5:before { content: counter(chapter)"."counter(section)"."counter(subsection)"."counter(subsubsection)" "; counter-increment: subsubsection }
h6:before { content: counter(chapter)"."counter(section)"."counter(subsection)"."counter(subsubsection)"."counter(paragraph)" "; counter-increment: paragraph}
li.h1 { margin-left: 0em }
li.h2 { margin-left: 1em; counter-reset: lsection lsubsection lsubsubsection lparagraph }
li.h3 { margin-left: 2em; counter-reset: lsubsection lsubsubsection lparagraph }
li.h4 { margin-left: 3em; counter-reset: lsubsubsection lparagraph }
li.h5 { margin-left: 4em; counter-reset: lparagraph }
li.h2:before { content: counter(lchapter)" "; counter-increment: lchapter }
li.h3:before { content: counter(lchapter)"."counter(lsection)" "; counter-increment: lsection }
li.h4:before { content: counter(lchapter)"."counter(lsection)"."counter(lsubsection)" "; counter-increment: lsubsection }
li.h5:before { content: counter(lchapter)"."counter(lsection)"."counter(lsubsection)"."counter(lsubsubsection)" "; counter-increment: lsubsubsection }
li.h6:before { content: counter(lchapter)"."counter(lsection)"."counter(lsubsection)"."counter(lsubsubsection)"."counter(lparagraph)" "; counter-increment: lparagraph}
li.h6 { margin-left: 5em }
ol, ul { margin-bottom: 0.5em; margin-top: 0.5em }
ol.loweralpha { list-style-type: lower-alpha }
ol.upperalpha { list-style-type: upper-alpha }
ol.lowerroman { list-style-type: lower-roman }
ol.upperroman { list-style-type: upper-roman }
ol.decimal { list-style-type: decimal }
ul.square { list-style-type: square }
ul.circle { list-style-type: circle }
ul.disc { list-style-type: disc }
li > p { margin: 0em }
img { border: 1px solid #000; padding: 0em; display: block; margin: 1em auto }
img.inline { border: 1px solid #000; padding: 0em; margin: 0em; display: inline }
pre { color: #000; background-color: #eee; margin-left: 2em; clear: both; overflow: auto }
div.unknown { font-family: monospace; color: #000; background-color: #fff; margin: 1em; padding: 1em; clear: both; border: 3px solid red}
pre.quoted { color: #000; background-color: #eee; margin-left: 0em; clear: both; overflow: auto  }
pre.rawlatex { color: #000; background-color: #ddd; border: 1px solid #000; padding: 0.1em; clear: both; overflow: auto  }
pre.address { font-family: Verdana, sans-serif; display: inline; margin: 0px; color: #000; background-color: #fff; overflow: auto }
span.target { text-decoration: underline }
div.vstfooter hr { width: 100%; margin: 0px }
div.vstfooter p { margin: 0px }
/*]]>*/
</style>

</head>
<body>

<h1 id="lgraph-db-on-gae-datastore">Graph DB on GAE datastore</h1>
<h2 id="lintroduction">Introduction</h2>

<p>
This is a simple API that provides a Graph DB abstraction over GAE datastore.
</p>

<p>
Use the API to create nodes and relationships between the nodes. Each node or relationship can have properties as name and value pairs.
</p>

<p>
Directionality of relationships (incoming or outgoing) is entirely semantic and up to user to define meaning - API allows for traversing in any direction.
</p>

<p>
There is always a reference node - eventhough it is not mandatory to use in a relationship graph.
You can use ref (or any) node to create new nodes even if the new ones are not related to it.
</p>

<p>
It can be used as a restful service or as a python API.
</p>

<h2 id="lrestful-service">Restful service</h2>
<h3 id="lregistration47authentication58">Registration/Authentication:</h3>

<p class="subh3">
Before using the restful API, you need to register with a username and password by visiting /auth/login - You need to pass the credentials in each API call.
</p>

<p>
Reference node's URL: "/graphdb/ref".
</p>

<p>
Nodes are identified a variety of means as given below in examples.
</p>

<p>
You can browse through the nodes and create new nodes/relations by starting at: "/graphdb/ref".
</p>

<h3 id="lapi-operations-40see-the-bottom-for-python-api4158">API operations (see the bottom for Python API):</h3>

<p>
In the below API operations, the graph nodes can be identified by following means:
</p>

<ul class="circle">
<li>

<p>
ref
</p>

</li>
<li>

<p>
node_id (the UUID)
</p>

</li>
<li>

<p>
Node(property_name=property_value, ...)
</p>


</li>
</ul>

<p>
In the below operations, &lt;node&gt; represents node identification as given above.
</p>

<p>
Note: Make sure to escape special characters like quotes, '(', and ')' in shell scripts.
</p>

<h4 id="lcreating-a-node">Creating a Node</h4>

<p>
Create a node (POSTing to either ref or another node identified by &lt;node&gt; below):
</p>

<p>
<strong>POST /graphdb/&lt;node&gt;</strong>
</p>

<p>
In request body, include properties/relations in "yaml", for example, as in:
</p>

<pre>
 #yaml start
 node:
   properties:
     title: The Matrix
     year: 1999
 #yaml end
</pre>

<p>
Another example
:
</p>

<pre>
 #yaml start
 node:
   properties:
     name: Keanu Reeves
   relations:
     - to: Node(title=The Matrix)
       type: ACTS_IN
       properties:
         name: Neo
 #yaml end
</pre>

<p>
Apart from the format of &lt;node&gt; above, there is one more way to address a node in a relationship:
</p>

<ul class="circle">
<li>

<p>
current
</p>


</li>
</ul>

<p>
This identifies the node to which the content is posted to.
</p>

<p>
Try above examples in the browser at url: /graphdb/ref.
</p>

<p>
The same example using curl:
</p>

<pre>
 curl -X "POST" -H "Content-Type: application/yaml" -H "Accept: application/json" -H "X-Auth-User: demo" -H "X-Auth-Password: demo" http://127.0.0.1:9080/graphdb/ref --data "node: { properties: { name: Keanu Reeves }, relations: [ { to: Node(title=The Matrix), type: ACTS_IN, properties: { name: Neo}  } ] }"
</pre>

<h4 id="lgetting-the-details-of-a-node58">Getting the details of a node:</h4>

<p>
<strong>GET /graphdb/&lt;node&gt;</strong>
</p>

<p>
This operation returns the response body with node id including properties, outgoing relations, and incoming relations, for example:
</p>

<pre>
 curl -X GET -H "Content-Type: application/yaml" -H "Accept: application/json" -H "X-Auth-User: demo" -H "X-Auth-Password: demo" http://127.0.0.1:9080/graphdb/Node(name=Keanu%20Reeves)
</pre>

<p>
Here is the response:
:
</p>

<pre>
 {"relationships": {"outgoing": [{"type_name": "ACTS_IN", "link": "/graphdb/13fed092-2c69-446e-8231-c2d257d9dcff", "properties": {"name": "Neo"}}], "incoming": []}, "properties": {"name": "Keanu Reeves"}}
</pre>

<h4 id="lupdating-a-node58">Updating a node:</h4>

<p>
Replace a node:
</p>

<p>
<strong>PUT /graphdb/&lt;node&gt;</strong>
</p>

<p>
In request body include "yaml" properties and relations (just like in POST) to replace with.
You cannot replace content of ref node - you need to delete individual child nodes.
</p>

<p>
Adding new properties or relations:
</p>

<p>
<strong>POST /graphdb/&lt;node&gt;</strong>
</p>

<p>
In request body include "yaml" just properties and relations (syntax just like in POST) to append to existing properties/relations.
You cannot replace content of ref node - you need to delete individual child nodes.
</p>

<h4 id="lremoving-a-node58">Removing a node:</h4>

<p>
<strong>DELETE /graphdb/&lt;node&gt;</strong>
</p>

<p>
This operation deletes the specified node and all of its properties. It also automatically removes all incoming/outgoing relations and their properties.
</p>

<h4 id="ldelete-all-nodes58">Delete all nodes:</h4>

<p>
<strong>DELETE /graphdb/nodes</strong>
</p>

<p>
It also deletes the ref node - next time it is required, it will be auto-created.
</p>

<h4 id="llist-all-nodes58">List all nodes:</h4>

<p>
<strong>GET /graphdb/nodes</strong>
</p>

<p>
This lists all nodes including their information just like in GET for a single node.
</p>

<h4 id="lsamples58">Samples:</h4>

<p class="subh4">
<strong>There are a lot of examples in SOCIAL_NETWORK.sh, BLOG.sh, and CATEGORIES.sh in samples/webapi folder</strong>
</p>

<h4 id="ltodo58">TODO:</h4>
<ol class="loweralpha">
<li>

<p>
Post to /graphdb/nodes instead of /graphdb/ref to create new nondes
</p>

</li>
<li>

<p>
Pagination support for listing
</p>


</li></ol>
<h1 id="lusing-python-api58">Using Python API:</h1>

<p>
You just need two files:
</p>

<ul class="circle">
<li>

<p>
model/entities.py
</p>

</li>
<li>

<p>
api/graph.py
</p>


</li>
</ul>

<p>
Once they are loaded into GAE environment, you can play with the API directly from the Interactive Console.
</p>

<h2 id="lsamples58">Samples:</h2>

<p>
Samples are available in samples/lib folder that you can copy/paste into the console.
</p>

<h1 id="lreferences58">References:</h1>
<ol class="decimal">
<li>

<p>
<a href="http://stackoverflow.com/questions/1630087/how-would-you-design-an-appengine-datastore-for-a-social-site-like-twitter">http://stackoverflow.com/questions/1630087/how-would-you-design-an-appengine-datastore-for-a-social-site-like-twitter</a>
</p>

</li>
<li>

<p>
<a href="http://neo4j.org/scratchpad/doc/screenshots/">http://neo4j.org/scratchpad/doc/screenshots/</a>
</p>

</li>
<li>

<p>
<a href="http://www.google.com/events/io/2009/sessions/SofterSideofSchemas.html">http://www.google.com/events/io/2009/sessions/SofterSideofSchemas.html</a>
</p>

</li>
<li>

<p>
<a href="http://www.google.com/events/io/2009/sessions/BuildingScalableComplexApps.html">http://www.google.com/events/io/2009/sessions/BuildingScalableComplexApps.html</a>
</p>


</li></ol>


</body>
</html>

